<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMU Los Ríos - Formulario Digital</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --border-color: #444; --header-bg: #f2f2f2; }
        body { font-family: 'Arial Narrow', Arial, sans-serif; background-color: #555; padding: 20px; font-size: 12px; }
        .page { background: white; width: 850px; margin: auto; padding: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 1px solid #000; }
        
        /* Estilos de Tabla tipo Formulario */
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        td, th { border: 1px solid var(--border-color); padding: 4px; vertical-align: top; }
        .header-title { text-align: center; font-weight: bold; font-size: 16px; background: var(--header-bg); }
        
        .section-label { font-weight: bold; background: #eee; font-size: 11px; text-transform: uppercase; }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%; border: none; outline: none; font-family: inherit; font-size: 12px; padding: 2px 0;
        }
        textarea { resize: none; }
        
        /* Checkboxes compactos */
        .check-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .check-item { display: flex; align-items: center; font-size: 10px; white-space: nowrap; }
        .check-item input { margin-right: 2px; }

        .btn-container { text-align: center; margin-top: 20px; }
        .btn-print { background: #d32f2f; color: white; padding: 15px 30px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-print:hover { background: #b71c1c; }

        .logo-placeholder { width: 60px; height: 60px; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 10px; text-align: center; border: 1px solid #000; }
    </style>
</head>
<body>

<div class="page" id="formulario">
    <table>
        <tr>
            <td width="15%">
                <img src="https://i.imgur.com/8Yl6S8S.png" alt="SAMU" style="width: 70px;">
            </td>
            <td width="70%" class="header-title">
                REGISTRO DE ATENCIÓN PREHOSPITALARIA SAMU LOS RÍOS [cite: 1]
            </td>
            <td width="15%" style="text-align: center;">
                <b>N° QTC</b><br>
                <input type="text" id="qtc" placeholder="0000" style="text-align: center; font-size: 14px; color: red;"> [cite: 5]
            </td>
        </tr>
    </table>

    <table>
        <tr>
            <td width="25%"><label>Fecha:</label><input type="date" id="fecha"> [cite: 2]</td>
            <td width="25%"><label>Comuna:</label><input type="text" id="comuna"> [cite: 3]</td>
            <td width="25%"><label>Fono:</label><input type="text" id="fono"> [cite: 4]</td>
            <td width="25%"><label>Móvil:</label><input type="text" id="movil"> [cite: 13]</td>
        </tr>
        <tr>
            <td colspan="2"><label>Solicitante:</label><input type="text" id="solicitante"> [cite: 6]</td>
            <td><label>CLAVE:</label><input type="text" id="clave"> [cite: 7]</td>
            <td><label>Motivo Consulta:</label><input type="text" id="motivo"> [cite: 8]</td>
        </tr>
    </table>

    <table>
        <tr>
            <td width="60%" class="section-label">Antecedentes Médicos [cite: 9]</td>
            <td width="40%" class="section-label">Evaluación Inicial [cite: 10]</td>
        </tr>
        <tr>
            <td>
                <div class="check-group">
                    <div class="check-item"><input type="checkbox" class="ant" value="ACV"> ACV [cite: 14]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="IAM"> IAM [cite: 15]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="DM"> DM [cite: 17]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="HTA"> HTA [cite: 18]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="M1"> M1 [cite: 19]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="M2"> M2 [cite: 19]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="M3"> M3 [cite: 19]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="Cardio"> Cardiopatía [cite: 20]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="ASMA"> ASMA [cite: 21]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="EPI"> EPI [cite: 22]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="ER"> ER [cite: 23]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="Demencia"> Demencia [cite: 24]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="EQZ"> EQZ [cite: 26]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="Parkinson"> Parkinson [cite: 28]</div>
                    <div class="check-item"><input type="checkbox" class="ant" value="Postrado"> Postrado [cite: 27]</div>
                </div>
            </td>
            <td>
                <label>CBD:</label> <input type="text" id="cbd" style="width: 70%;"> [cite: 10]<br>
                <div class="check-item"><input type="checkbox" id="respira"> Respira [cite: 11]</div>
                <div class="check-item"><input type="checkbox" id="consciente"> Consciente [cite: 12]</div>
            </td>
        </tr>
    </table>

    <table>
        <tr><td colspan="6" class="section-label">Datos del Paciente [cite: 38]</td></tr>
        <tr>
            <td colspan="3"><label>Nombre:</label><input type="text" id="nombre"> [cite: 41]</td>
            <td><label>RUN:</label><input type="text" id="run"> [cite: 43]</td>
            <td><label>Edad:</label><input type="text" id="edad"> [cite: 42]</td>
            <td><label>Sexo:</label> 
                <select id="sexo">
                    <option value="M">M [cite: 45]</option>
                    <option value="F">F [cite: 46]</option>
                </select> [cite: 48]
            </td>
        </tr>
        <tr>
            <td colspan="2"><label>Previsión:</label><input type="text" id="prevision"> [cite: 48]</td>
            <td colspan="2"><label>DAU:</label><input type="text" id="dau"> [cite: 49]</td>
            <td colspan="2">
                <b>Accidente:</b> [cite: 55]
                <select id="tipo_accidente">
                    <option value="No">N/A</option>
                    <option value="Transito">Tránsito [cite: 50]</option>
                    <option value="Laboral">Laboral [cite: 53]</option>
                    <option value="Escolar">Escolar [cite: 54]</option>
                </select>
            </td>
        </tr>
    </table>

    <table>
        <tr><td colspan="8" class="section-label">Signos Vitales [cite: 67]</td></tr>
        <tr>
            <td><label>FR [cite: 56]</label><input type="text" id="fr"></td>
            <td><label>FC [cite: 57]</label><input type="text" id="fc"></td>
            <td><label>P/A [cite: 58]</label><input type="text" id="pa"></td>
            <td><label>PAM [cite: 59]</label><input type="text" id="pam"></td>
            <td><label>GSW [cite: 60]</label><input type="text" id="gsw"></td>
            <td><label>SAT [cite: 61]</label><input type="text" id="sat"></td>
            <td><label>HGT [cite: 63]</label><input type="text" id="hgt"></td>
            <td><label>T° [cite: 64]</label><input type="text" id="temp"></td>
        </tr>
    </table>

    <table>
        <tr><td class="section-label">Informe de Atención [cite: 66] / Observaciones [cite: 78]</td></tr>
        <tr>
            <td><textarea id="informe" rows="10"></textarea></td>
        </tr>
    </table>

    <table>
        <tr><td colspan="4" class="section-label">Destino del Paciente [cite: 68]</td></tr>
        <tr>
            <td width="25%"><label>Hospital:</label><input type="text" id="dest_hosp"> [cite: 69]</td>
            <td width="25%"><label>SAR/SAPU:</label><input type="text" id="dest_sar"> [cite: 70, 71]</td>
            <td width="25%"><div class="check-item"><input type="checkbox" id="rechaza"> Rechaza Traslado [cite: 74]</div></td>
            <td width="25%"><label>Hora Fallecimiento:</label><input type="time" id="hora_fall"> [cite: 76]</td>
        </tr>
    </table>
</div>

<div class="btn-container">
    <button class="btn-print" onclick="generarPDF()">GENERAR PDF PARA IMPRESIÓN</button>
</div>

<script>
    async function generarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        // El enfoque aquí es diferente: creamos el PDF basándonos en los datos
        // pero con un diseño estructurado por coordenadas fijas para que parezca el papel.
        
        // Bordes y Cabecera
        doc.rect(5, 5, 200, 287);
        doc.setFontSize(14);
        doc.text("REGISTRO DE ATENCIÓN PREHOSPITALARIA SAMU LOS RÍOS", 25, 15);
        
        doc.setFontSize(10);
        doc.text(`QTC: ${document.getElementById('qtc').value}`, 170, 15);
        doc.line(5, 20, 205, 20);

        // Bloque Logística
        doc.text(`Fecha: ${document.getElementById('fecha').value}`, 10, 27);
        doc.text(`Comuna: ${document.getElementById('comuna').value}`, 60, 27);
        doc.text(`Móvil: ${document.getElementById('movil').value}`, 120, 27);
        doc.text(`Clave: ${document.getElementById('clave').value}`, 170, 27);
        doc.line(5, 32, 205, 32);

        // Bloque Paciente
        doc.setFont("helvetica", "bold");
        doc.text("DATOS DEL PACIENTE", 10, 38);
        doc.setFont("helvetica", "normal");
        doc.text(`Nombre: ${document.getElementById('nombre').value}`, 10, 45);
        doc.text(`RUN: ${document.getElementById('run').value}  Edad: ${document.getElementById('edad').value}  Sexo: ${document.getElementById('sexo').value}`, 10, 52);
        doc.text(`Previsión: ${document.getElementById('prevision').value}  DAU: ${document.getElementById('dau').value}`, 10, 59);
        doc.line(5, 65, 205, 65);

        // Bloque Antecedentes
        doc.setFont("helvetica", "bold");
        doc.text("ANTECEDENTES", 10, 71);
        doc.setFont("helvetica", "normal");
        let ants = [];
        document.querySelectorAll('.ant:checked').forEach(e => ants.push(e.value));
        doc.text(ants.join(", ") || "Sin antecedentes registrados", 10, 78, {maxWidth: 190});
        doc.line(5, 85, 205, 85);

        // Bloque Signos Vitales
        doc.setFont("helvetica", "bold");
        doc.text("SIGNOS VITALES", 10, 92);
        doc.setFont("helvetica", "normal");
        const sv = `FR: ${document.getElementById('fr').value} | FC: ${document.getElementById('fc').value} | P/A: ${document.getElementById('pa').value} | PAM: ${document.getElementById('pam').value} | GSW: ${document.getElementById('gsw').value} | SAT: ${document.getElementById('sat').value} | HGT: ${document.getElementById('hgt').value} | T: ${document.getElementById('temp').value}`;
        doc.text(sv, 10, 99);
        doc.line(5, 105, 205, 105);

        // Bloque Informe
        doc.setFont("helvetica", "bold");
        doc.text("INFORME DE ATENCIÓN", 10, 112);
        doc.setFont("helvetica", "normal");
        const info = document.getElementById('informe').value;
        const splitInfo = doc.splitTextToSize(info, 190);
        doc.text(splitInfo, 10, 119);

        // Bloque Final / Destino
        doc.line(5, 260, 205, 260);
        doc.text(`Destino: ${document.getElementById('dest_hosp').value || document.getElementById('dest_sar').value}`, 10, 270);
        if(document.getElementById('hora_fall').value) doc.text(`Hora Fallecimiento: ${document.getElementById('hora_fall').value}`, 140, 270);

        doc.save(`SAMU_QTC_${document.getElementById('qtc').value || 'S-N'}.pdf`);
    }
</script>

</body>
</html>